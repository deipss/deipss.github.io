---
layout: default
title: Jvm Sandbox
parent: Sandbox
nav_order: 1
---
# ASM
- https://asm.ow2.io/
```text
ASM is an all purpose Java bytecode manipulation and analysis framework. It can be used to modify existing classes or to dynamically generate classes, directly in binary form. ASM provides some common bytecode transformations and analysis algorithms from which custom complex transformations and code analysis tools can be built. ASM offers similar functionality as other Java bytecode frameworks, but is focused on performance. Because it was designed and implemented to be as small and as fast as possible, it is well suited for use in dynamic systems (but can of course be used in a static way too, e.g. in compilers).

ASM是一个通用的Java字节码操作和分析框架。它可用于修改现有类或直接以二进制形式动态生成类。ASM提供了一些通用的字节码转换和分析算法，可以从这些算法中构建定制的复杂转换和代码分析工具。ASM提供了与其他Java字节码框架类似的功能，但更注重性能。因为它的设计和实现是尽可能的小和快，所以它非常适合在动态系统中使用(当然也可以在静态方式中使用，例如在编译器中)。
```

## 使用ASM技术来实现的插件
<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="272px" preserveAspectRatio="none" style="width:549px;height:272px;background:#FFFFFF;" version="1.1" viewBox="0 0 549 272" width="549px" zoomAndPan="magnify"><defs/><g><!--entity asm--><g id="elem_asm"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="285" y="219.97"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="335" y="224.97"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="333" y="226.97"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="333" y="230.97"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="300" y="253.5052">ASM</text></g><!--entity jsandbox--><g id="elem_jsandbox"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128" x="57" y="113.48"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="165" y="118.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="163" y="120.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="163" y="124.48"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="72" y="147.0152">jvm sandbox</text></g><!--entity repeater--><g id="elem_repeater"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="7" y="7"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="177" y="12"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="175" y="14"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="175" y="18"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="22" y="40.5352">jvm sandbox repeater</text></g><!--entity arthas--><g id="elem_arthas"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="232.5" y="7"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="295.5" y="12"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="293.5" y="14"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="293.5" y="18"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="247.5" y="40.5352">arthas</text></g><!--entity grey--><g id="elem_grey"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="229" y="113.48"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="279" y="118.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="277" y="120.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="277" y="124.48"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="244" y="147.0152">grey</text></g><!--entity btrace--><g id="elem_btrace"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="334.5" y="113.48"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="397.5" y="118.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="395.5" y="120.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="395.5" y="124.48"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="349.5" y="147.0152">btrace</text></g><!--entity AspectJ--><g id="elem_AspectJ"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="453" y="113.48"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="523" y="118.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="521" y="120.48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="521" y="124.48"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="468" y="147.0152">AspectJ</text></g><!--link repeater to jsandbox--><g id="link_repeater_jsandbox"><path d="M106.12,53.91 C108.99,69.66 112.82,90.75 115.88,107.57 " fill="none" id="repeater-to-jsandbox" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="116.89,112.1,119.2302,102.5332,116.0031,107.1793,111.3571,103.9522,116.89,112.1" style="stroke:#181818;stroke-width:1.0;"/></g><!--link arthas to grey--><g id="link_arthas_grey"><path d="M271.83,53.91 C270.34,69.52 268.34,90.38 266.74,107.13 " fill="none" id="arthas-to-grey" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="266.17,112.1,271.0018,103.5178,266.642,107.1223,263.0375,102.7626,266.17,112.1" style="stroke:#181818;stroke-width:1.0;"/></g><!--link grey to asm--><g id="link_grey_asm"><path d="M276.15,160.4 C284.66,176.28 296.09,197.6 305.14,214.5 " fill="none" id="grey-to-asm" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="307.87,218.59,307.1212,208.7696,305.4978,214.1886,300.0789,212.5652,307.87,218.59" style="stroke:#181818;stroke-width:1.0;"/></g><!--link jsandbox to asm--><g id="link_jsandbox_asm"><path d="M164.18,160.4 C198.36,178.35 245.76,203.23 279.28,220.84 " fill="none" id="jsandbox-to-asm" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="283.54,223.6,277.4356,215.871,279.1145,221.273,273.7125,222.9519,283.54,223.6" style="stroke:#181818;stroke-width:1.0;"/></g><!--link btrace to asm--><g id="link_btrace_asm"><path d="M363.85,160.4 C355.34,176.28 343.91,197.6 334.86,214.5 " fill="none" id="btrace-to-asm" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="332.13,218.59,339.9211,212.5652,334.5022,214.1886,332.8788,208.7696,332.13,218.59" style="stroke:#181818;stroke-width:1.0;"/></g><!--link AspectJ to asm--><g id="link_AspectJ_asm"><path d="M459.38,160.4 C430.09,177.59 389.95,201.15 360.27,218.58 " fill="none" id="AspectJ-to-asm" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="356.23,221.54,366.0173,220.4401,360.5437,219.0118,361.9721,213.5382,356.23,221.54" style="stroke:#181818;stroke-width:1.0;"/></g><!--SRC=[LOuz2iCm34Ptdq8No1K2MGkTEfOCYYCI0lv15Y6zVIedTbtGeE_fuo4RN0oUlC3mUWAcxpZptdO72VqyXMDKkDtXxm9CaL28SwK4OwiHMLPC3LYOFg1bNHe-2QEb1WmfafM7CSKANTV_lhZ4cMLJzchIvqkhWijUu-qk-GG0]--></g></svg>

如图所示，业界有许多的技术都使用ASM技术来实现一些提交的插件，主要目的不乏：
- 参数实时打印
- 调用计时
- 面向切面编程

# Java Agent时
使用java agent技术时需要注意的问题
- 能解决jar包依赖冲突
- 处理类加载隔离问题
- 尽量保持agent轻量级
- 保证后续场景可扩展
- 保证业务方最低的接入集成成本



#  参考文献

- https://www.baeldung.com/java-classloaders 类加载器
- https://tech.hipac.cn/archives/aeb6e3616cf74e1984b908fc1cd98913#jacoco 多agent治理在海拍客的应用与实践
- https://arthas.aliyun.com/doc/agent.html
- https://www.cnblogs.com/rickiyang/p/11368932.html
- https://juejin.cn/post/7018237356532563999
